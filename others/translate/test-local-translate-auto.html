<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°ç¿»è¯‘åŠŸèƒ½æµ‹è¯• - è‡ªåŠ¨åŒ–æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #555;
            margin-bottom: 15px;
        }
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .console-output {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .test-button {
            background-color: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        .test-button:hover {
            background-color: #3182ce;
        }
        .test-button:disabled {
            background-color: #a0aec0;
            cursor: not-allowed;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4299e1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .summary {
            background-color: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .summary h3 {
            color: #2d3748;
            margin-top: 0;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4299e1;
        }
        .stat-label {
            font-size: 14px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æœ¬åœ°ç¿»è¯‘åŠŸèƒ½è‡ªåŠ¨åŒ–æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">æµ‹è¯•æ§åˆ¶</div>
            <button id="run-tests" class="test-button">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button id="run-basic" class="test-button">ğŸ” è¿è¡ŒåŸºç¡€æµ‹è¯•</button>
            <button id="run-performance" class="test-button">âš¡ è¿è¡Œæ€§èƒ½æµ‹è¯•</button>
            <button id="clear-console" class="test-button">ğŸ—‘ï¸ æ¸…ç©ºæ§åˆ¶å°</button>
            <span id="loading-indicator"></span>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•æ‘˜è¦</div>
            <div id="test-summary" class="summary" style="display: none;">
                <h3>æµ‹è¯•ç»“æœç»Ÿè®¡</h3>
                <div class="stats">
                    <div class="stat-item">
                        <div id="total-tests" class="stat-number">0</div>
                        <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div id="passed-tests" class="stat-number">0</div>
                        <div class="stat-label">é€šè¿‡</div>
                    </div>
                    <div class="stat-item">
                        <div id="failed-tests" class="stat-number">0</div>
                        <div class="stat-label">å¤±è´¥</div>
                    </div>
                    <div class="stat-item">
                        <div id="test-duration" class="stat-number">0ms</div>
                        <div class="stat-label">è€—æ—¶</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">å®æ—¶æµ‹è¯•ç»“æœ</div>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <div class="test-title">æ§åˆ¶å°è¾“å‡º</div>
            <div id="console-output" class="console-output">ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
        </div>
    </div>

    <!-- åŠ è½½æœ¬åœ°ç¿»è¯‘è„šæœ¬ -->
    <script src="local-translate.js"></script>
    
    <script>
        class LocalTranslateTester {
            constructor() {
                this.testResults = [];
                this.consoleOutput = document.getElementById('console-output');
                this.testResultsDiv = document.getElementById('test-results');
                this.loadingIndicator = document.getElementById('loading-indicator');
                this.originalConsoleLog = console.log;
                this.originalConsoleError = console.error;
                this.originalConsoleWarn = console.warn;
                this.setupConsoleCapture();
                this.bindEvents();
            }

            setupConsoleCapture() {
                // æ•è·æ§åˆ¶å°è¾“å‡º
                console.log = (...args) => {
                    this.originalConsoleLog.apply(console, args);
                    this.appendConsoleOutput(args.join(' '), 'log');
                };
                
                console.error = (...args) => {
                    this.originalConsoleError.apply(console, args);
                    this.appendConsoleOutput(args.join(' '), 'error');
                };
                
                console.warn = (...args) => {
                    this.originalConsoleWarn.apply(console, args);
                    this.appendConsoleOutput(args.join(' '), 'warn');
                };
            }

            bindEvents() {
                document.getElementById('run-tests').addEventListener('click', () => this.runAllTests());
                document.getElementById('run-basic').addEventListener('click', () => this.runBasicTests());
                document.getElementById('run-performance').addEventListener('click', () => this.runPerformanceTests());
                document.getElementById('clear-console').addEventListener('click', () => this.clearConsole());
            }

            appendConsoleOutput(message, type = 'log') {
                const timestamp = new Date().toLocaleTimeString();
                this.consoleOutput.innerHTML += `[${timestamp}] ${message}\n`;
                this.consoleOutput.scrollTop = this.consoleOutput.scrollHeight;
            }

            clearConsole() {
                this.consoleOutput.innerHTML = 'æ§åˆ¶å°å·²æ¸…ç©º...\n';
            }

            addTestResult(title, success, message, details = '') {
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <strong>${success ? 'âœ…' : 'âŒ'} ${title}</strong>
                    ${message ? `<br>${message}` : ''}
                    ${details ? `<br><small style="color: #666;">${details}</small>` : ''}
                `;
                this.testResultsDiv.appendChild(resultDiv);
                this.testResults.push({ title, success, message, details });
            }

            async runAllTests() {
                this.testResults = [];
                this.testResultsDiv.innerHTML = '';
                this.loadingIndicator.innerHTML = '<div class="loading"></div>';
                
                const startTime = performance.now();
                
                await this.runBasicTests();
                await this.runPerformanceTests();
                await this.runEdgeCaseTests();
                
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(0);
                
                this.loadingIndicator.innerHTML = '';
                this.updateSummary(duration);
            }

            async runBasicTests() {
                console.log('=== å¼€å§‹åŸºç¡€æµ‹è¯• ===');
                
                // æµ‹è¯•1: LocalTranslateå¯¹è±¡å­˜åœ¨æ€§
                try {
                    if (typeof LocalTranslate !== 'undefined') {
                        this.addTestResult('LocalTranslateå¯¹è±¡å­˜åœ¨æ€§', true, 'LocalTranslateå¯¹è±¡å·²åŠ è½½');
                    } else {
                        this.addTestResult('LocalTranslateå¯¹è±¡å­˜åœ¨æ€§', false, 'LocalTranslateå¯¹è±¡æœªå®šä¹‰');
                    }
                } catch (error) {
                    this.addTestResult('LocalTranslateå¯¹è±¡å­˜åœ¨æ€§', false, error.message);
                }

                // æµ‹è¯•2: translateæ–¹æ³•å­˜åœ¨æ€§
                try {
                    if (typeof LocalTranslate.translate === 'function') {
                        this.addTestResult('translateæ–¹æ³•å­˜åœ¨æ€§', true, 'translateæ–¹æ³•å¯ç”¨');
                    } else {
                        this.addTestResult('translateæ–¹æ³•å­˜åœ¨æ€§', false, 'translateæ–¹æ³•ä¸å¯ç”¨');
                    }
                } catch (error) {
                    this.addTestResult('translateæ–¹æ³•å­˜åœ¨æ€§', false, error.message);
                }

                // æµ‹è¯•3: ç®€å•è‹±æ–‡åˆ°ä¸­æ–‡ç¿»è¯‘
                try {
                    const result = LocalTranslate.translate('hello', 'en', 'zh');
                    const success = result === 'ä½ å¥½';
                    this.addTestResult('è‹±æ–‡åˆ°ä¸­æ–‡ç¿»è¯‘', success, 
                        success ? `ç¿»è¯‘ç»“æœ: ${result}` : `æœŸæœ›: ä½ å¥½, å®é™…: ${result}`);
                } catch (error) {
                    this.addTestResult('è‹±æ–‡åˆ°ä¸­æ–‡ç¿»è¯‘', false, error.message);
                }

                // æµ‹è¯•4: ç®€å•ä¸­æ–‡åˆ°è‹±æ–‡ç¿»è¯‘
                try {
                    const result = LocalTranslate.translate('ä½ å¥½', 'zh', 'en');
                    const success = result === 'hello';
                    this.addTestResult('ä¸­æ–‡åˆ°è‹±æ–‡ç¿»è¯‘', success, 
                        success ? `ç¿»è¯‘ç»“æœ: ${result}` : `æœŸæœ›: hello, å®é™…: ${result}`);
                } catch (error) {
                    this.addTestResult('ä¸­æ–‡åˆ°è‹±æ–‡ç¿»è¯‘', false, error.message);
                }

                // æµ‹è¯•5: å¤æ‚çŸ­è¯­ç¿»è¯‘
                try {
                    const result = LocalTranslate.translate('good morning', 'en', 'zh');
                    const success = result.includes('æ—©ä¸Šå¥½');
                    this.addTestResult('å¤æ‚çŸ­è¯­ç¿»è¯‘', success, 
                        success ? `ç¿»è¯‘ç»“æœ: ${result}` : `æœŸæœ›åŒ…å«: æ—©ä¸Šå¥½, å®é™…: ${result}`);
                } catch (error) {
                    this.addTestResult('å¤æ‚çŸ­è¯­ç¿»è¯‘', false, error.message);
                }
            }

            async runPerformanceTests() {
                console.log('=== å¼€å§‹æ€§èƒ½æµ‹è¯• ===');
                
                // æµ‹è¯•1: å•æ¬¡ç¿»è¯‘æ€§èƒ½
                try {
                    const start = performance.now();
                    const result = LocalTranslate.translate('hello world', 'en', 'zh');
                    const end = performance.now();
                    const duration = (end - start).toFixed(2);
                    
                    this.addTestResult('å•æ¬¡ç¿»è¯‘æ€§èƒ½', true, 
                        `ç¿»è¯‘ç»“æœ: ${result}, è€—æ—¶: ${duration}ms`, `æœŸæœ› < 10ms`);
                } catch (error) {
                    this.addTestResult('å•æ¬¡ç¿»è¯‘æ€§èƒ½', false, error.message);
                }

                // æµ‹è¯•2: æ‰¹é‡ç¿»è¯‘æ€§èƒ½
                try {
                    const start = performance.now();
                    for (let i = 0; i < 100; i++) {
                        LocalTranslate.translate('hello', 'en', 'zh');
                    }
                    const end = performance.now();
                    const duration = (end - start).toFixed(2);
                    
                    this.addTestResult('æ‰¹é‡ç¿»è¯‘æ€§èƒ½', duration < 100, 
                        `100æ¬¡ç¿»è¯‘è€—æ—¶: ${duration}ms`, `æœŸæœ› < 100ms`);
                } catch (error) {
                    this.addTestResult('æ‰¹é‡ç¿»è¯‘æ€§èƒ½', false, error.message);
                }
            }

            async runEdgeCaseTests() {
                console.log('=== å¼€å§‹è¾¹ç•Œæƒ…å†µæµ‹è¯• ===');
                
                // æµ‹è¯•1: ç©ºå­—ç¬¦ä¸²å¤„ç†
                try {
                    const result = LocalTranslate.translate('', 'en', 'zh');
                    const success = result === '';
                    this.addTestResult('ç©ºå­—ç¬¦ä¸²å¤„ç†', success, 
                        success ? 'æ­£ç¡®å¤„ç†ç©ºå­—ç¬¦ä¸²' : `ç»“æœ: "${result}"`);
                } catch (error) {
                    this.addTestResult('ç©ºå­—ç¬¦ä¸²å¤„ç†', false, error.message);
                }

                // æµ‹è¯•2: ç›¸åŒè¯­è¨€ç¿»è¯‘
                try {
                    const result = LocalTranslate.translate('hello', 'en', 'en');
                    const success = result === 'hello';
                    this.addTestResult('ç›¸åŒè¯­è¨€ç¿»è¯‘', success, 
                        success ? 'æ­£ç¡®å¤„ç†ç›¸åŒè¯­è¨€' : `æœŸæœ›: hello, å®é™…: ${result}`);
                } catch (error) {
                    this.addTestResult('ç›¸åŒè¯­è¨€ç¿»è¯‘', false, error.message);
                }

                // æµ‹è¯•3: ä¸æ”¯æŒçš„è¯­è¨€å¯¹
                try {
                    const result = LocalTranslate.translate('hello', 'en', 'jp');
                    this.addTestResult('ä¸æ”¯æŒçš„è¯­è¨€å¯¹', false, 
                        `åº”è¯¥æŠ›å‡ºå¼‚å¸¸ï¼Œä½†è¿”å›: ${result}`);
                } catch (error) {
                    this.addTestResult('ä¸æ”¯æŒçš„è¯­è¨€å¯¹', true, 
                        `æ­£ç¡®æŠ›å‡ºå¼‚å¸¸: ${error.message}`);
                }
            }

            updateSummary(duration) {
                const total = this.testResults.length;
                const passed = this.testResults.filter(r => r.success).length;
                const failed = total - passed;

                document.getElementById('total-tests').textContent = total;
                document.getElementById('passed-tests').textContent = passed;
                document.getElementById('failed-tests').textContent = failed;
                document.getElementById('test-duration').textContent = duration + 'ms';
                
                const summaryDiv = document.getElementById('test-summary');
                summaryDiv.style.display = 'block';
                
                if (failed === 0) {
                    summaryDiv.className = 'summary';
                    summaryDiv.style.backgroundColor = '#f0fff4';
                    summaryDiv.style.borderColor = '#9ae6b4';
                } else if (failed < total * 0.3) {
                    summaryDiv.className = 'summary';
                    summaryDiv.style.backgroundColor = '#fffff0';
                    summaryDiv.style.borderColor = '#f6e05e';
                } else {
                    summaryDiv.className = 'summary';
                    summaryDiv.style.backgroundColor = '#fff5f5';
                    summaryDiv.style.borderColor = '#fc8181';
                }
            }
        }

        // åˆå§‹åŒ–æµ‹è¯•å™¨
        document.addEventListener('DOMContentLoaded', function() {
            new LocalTranslateTester();
        });
    </script>
</body>
</html>